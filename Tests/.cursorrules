# ABXRLib Unity Test Suite - Cursor Rules

> **Note:** This file contains test-specific guidelines. For general project rules, see the parent `.cursorrules` file.

## Test Development Guidelines

### Test Name Generation
- **ALWAYS** use `TestHelpers.GenerateRandomName(prefix)` for generating unique test names
- **NEVER** use hardcoded names that could cause test conflicts
- **Examples:**
  ```csharp
  string eventName = TestHelpers.GenerateRandomName("event");
  string assessmentName = TestHelpers.GenerateRandomName("assessment");
  string objectiveName = TestHelpers.GenerateRandomName("objective");
  string interactionName = TestHelpers.GenerateRandomName("interaction");
  ```

### SCORM Educational Content Hierarchy
When testing educational analytics events, follow SCORM standards:

#### Assessment → Objective → Interaction Hierarchy
- **Assessments** are the top-level learning containers
- **Objectives** happen within Assessments
- **Interactions** can happen within Assessments OR within Objectives
- **Multiple Objectives** can exist within one Assessment
- **Multiple Interactions** can exist within one Assessment or one Objective

#### Proper Test Sequencing
```csharp
// Correct SCORM hierarchy test pattern:
Abxr.EventAssessmentStart(assessmentName);
yield return new WaitForSeconds(0.2f);

Abxr.EventObjectiveStart(objectiveName);
yield return new WaitForSeconds(0.2f);

Abxr.EventInteractionStart(interactionName, interactionMeta);
yield return new WaitForSeconds(0.3f);

Abxr.EventInteractionComplete(interactionName, type, result, response);
yield return new WaitForSeconds(0.2f);

Abxr.EventObjectiveComplete(objectiveName, score, status);
yield return new WaitForSeconds(0.2f);

Abxr.EventAssessmentComplete(assessmentName, score, status);
```

#### Event Start/Complete Pairs
- **AssessmentComplete** should typically have **AssessmentStart** first
- **ObjectiveComplete** should typically have **ObjectiveStart** first  
- **InteractionComplete** should typically have **InteractionStart** first
- **Exception:** Test orphan events (complete without start) for error handling

### Shared Authentication Session
- **`_AuthenticationTests`** runs first (alphabetical ordering ensures this)
- **All other test classes** use `SharedAuthenticationHelper` to reuse the authenticated session
- **Setup pattern:**
  ```csharp
  [UnitySetUp]
  public IEnumerator UnitySetUp()
  {
      yield return SharedAuthenticationHelper.EnsureAuthenticated();
  }
  
  [TearDown]
  public void TearDown()
  {
      TestHelpers.CleanupTestEnvironment();
      _dataCapture?.Clear();
  }
  
  [UnityTearDown]
  public void UnityTearDown()
  {
      SharedAuthenticationHelper.ResetAuthenticationState();
  }
  ```

### Test Types
- **Unit Tests**: Test specific API functionality with `TestDataCapture` and meaningful assertions
- **Integration Tests**: Test end-to-end behavior with `new WaitForSeconds()` and exception-free verification
- **Use unit tests** for testing specific API behavior
- **Use integration tests** for testing complete workflows and server communication

### Event Interaction Testing
- **EventInteractionStart** takes `(string interactionName, Dictionary<string, string> meta = null)`
- **Pass InteractionType in metadata:** `["interaction_type"] = type.ToString()`
- **Valid InteractionTypes:** Null, Bool, Select, Text, Rating, Number, Matching, Performance, Sequencing
- **Example:**
  ```csharp
  var interactionMeta = new Dictionary<string, string> { ["interaction_type"] = Abxr.InteractionType.Select.ToString() };
  Abxr.EventInteractionStart(interactionName, interactionMeta);
  ```

### Test Isolation
- Each test should be independent and not rely on state from other tests
- Use randomized names to prevent test interference
- Clean up test state in `[TearDown]` methods
- Reset shared authentication state between test runs

### Error Handling
- Test both success and failure scenarios
- Test orphan events (complete without start) for robustness
- Use `LogAssert.Expect()` for expected error logs
- Test edge cases and boundary conditions

### Test Class Structure
- Use `[TestFixture, Category("PostAuth")]` for all test classes except `_AuthenticationTests`
- Use `[TestFixture, Category("Authentication")]` for `_AuthenticationTests`
- Include proper `using` statements for test utilities
- Follow the established setup/teardown patterns

### Code Style
- Use descriptive test method names: `Test_Feature_Scenario_ExpectedResult`
- Add comprehensive comments explaining SCORM hierarchy and test purpose
- Group related tests with `#region` comments
- Use meaningful variable names and avoid magic numbers
- Follow Unity Test Framework conventions with `[UnityTest]` for coroutine tests
